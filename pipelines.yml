pipelines:
  - name: zen_npm_demo_pipelines
    steps:
      - name: NpmZenBuild
        type: NpmBuild
        configuration:
          npmArgs: --no-progress --no-audit
          sourceLocation: /
          repositoryName: npm
          inputResources:
            - name: wmanning_gitRepo
          integrations:
            - name: ArtifactoryUnified
      - name: NpmBuildPublish
        type: NpmPublish
        configuration:
          repositoryName: npm
          autoPublishBuildInfo: true
          forceXrayScan: false 
          inputSteps:
            - name: NpmZenBuild
          integrations:
            - name: ArtifactoryUnified
          outputResources:
            - name: NpmBuildInfo
        execution:
          onStart:
            - export inputNpmBuildStepName="zen_frontend"
      - name: NpmBuildInfoPromotedQA
        type: PromoteBuild
        configuration:
          targetRepository: npm-release-local
          includeDependencies: true    
          status: "Released" 
          comment: "This is Zen Front End is ready for release"
          copy: true
          integrations:
            - name: ArtifactoryUnified
          inputResources:
            - name: NpmBuildInfo
          outputResources:
            - name: NpmBuildQA
      - name: NpmBuildInfoPromotedProd
        type: PromoteBuild
        configuration:
          targetRepository: npm-release-local
          includeDependencies: true    
          status: "QA - Tested" 
          comment: "This build has passed all QA testing"
          copy: true
          integrations:
            - name: ArtifactoryUnified
          inputResources:
            - name: NpmBuildInfoPromotedQA
          outputResources:
            - name: NpmBuildInfoPromotedProd
      - name: NPMZenBundle
        type: CreateReleaseBundle
        configuration:
          releaseBundleName: NPMZenBundle
          releaseBundleVersion: v1.0.$run_number
          dryRun: false
          sign: true
          description: "Zen NPM Release Bundle"
          inputResources:
            - name: NpmBuildInfoPromotedProd
          outputResources:
            - name: NPMZenBundle

      